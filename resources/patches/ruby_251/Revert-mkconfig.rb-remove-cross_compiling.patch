From 19d37d3c84655865e2c55d7b8dceb94112429700 Mon Sep 17 00:00:00 2001
From: "Sean P. McDonald" <sean.mcdonald@puppetlabs.com>
Date: Fri, 10 Aug 2018 13:33:53 -0700
Subject: [PATCH] Revert "mkconfig.rb: remove cross_compiling"

This reverts commit d5c776ad58990f64f671e796df5cc6efdbe87677.
---
 common.mk        | 1 +
 tool/mkconfig.rb | 2 ++
 2 files changed, 3 insertions(+)

diff --git a/common.mk b/common.mk
index 2175f67eba..98604d169e 100644
--- a/common.mk
+++ b/common.mk
@@ -714,6 +714,7 @@ $(RBCONFIG): $(srcdir)/tool/mkconfig.rb config.status $(srcdir)/version.h
 	-e '(mis.delete(ARGF.path); ARGF.close) if /ONIG_UNICODE_VERSION_STRING +"#{Regexp.quote(version)}"/o' \
 	$(UNICODE_VERSION) $(UNICODE_DATA_HEADERS)
 	$(Q)$(BOOTSTRAPRUBY) $(srcdir)/tool/mkconfig.rb \
+		-cross_compiling=$(CROSS_COMPILING) \
 		-arch=$(arch) -version=$(RUBY_PROGRAM_VERSION) \
 		-install_name=$(RUBY_INSTALL_NAME) \
 		-so_name=$(RUBY_SO_NAME) \
diff --git a/tool/mkconfig.rb b/tool/mkconfig.rb
index d6c86b4803..372e0868c7 100755
--- a/tool/mkconfig.rb
+++ b/tool/mkconfig.rb
@@ -8,11 +8,13 @@
 # avoid warnings with -d.
 $install_name ||= nil
 $so_name ||= nil
+$cross_compiling ||= nil
 $unicode_version ||= nil
 arch = $arch or raise "missing -arch"
 version = $version or raise "missing -version"
 
 srcdir = File.expand_path('../..', __FILE__)
+$:.replace [srcdir+"/lib"] unless $cross_compiling == "yes"
 $:.unshift(".")
 
 require "fileutils"
-- 
2.18.0.windows.1

